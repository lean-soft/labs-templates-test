{
	"options": [{
		"enabled": false,
		"definition": {
			"id": "5d58cc01-7c75-450c-be18-a388ddb129ec"
		},
		"inputs": {
			"branchFilters": "[\"+refs/heads/*\"]",
			"additionalFields": "{}"
		}
	}, {
		"enabled": false,
		"definition": {
			"id": "a9db38f9-9fdc-478c-b0f9-464221e58316"
		},
		"inputs": {
			"workItemType": "1076",
			"assignToRequestor": "true",
			"additionalFields": "{}"
		}
	}],
	"variables": {
		"azureAccountName": {
			"value": ""
		},
		"azurePassword": {
			"value": ""
		},
		"azureResourceLocation": {
			"value": ""
		},
		"azureSubscriptionId": {
			"value": ""
		},
		"envFolder": {
			"value": "",
			"allowOverride": true
		},
		"envInstanceName": {
			"value": ""
		},
		"groupId": {
			"value": "0000"
		},
		"imagesJson": {
			"value": ""
		},
		"labsUserId": {
			"value": ""
		},
		"prefix": {
			"value": ""
		},
		"StorageAccountName": {
			"value": ""
		},
		"system.debug": {
			"value": "false",
			"allowOverride": true
		}
	},
	"retentionRules": [{
		"branches": ["+refs/heads/*"],
		"artifacts": [],
		"artifactTypesToDelete": ["FilePath", "SymbolStore"],
		"daysToKeep": 10,
		"minimumToKeep": 1,
		"deleteBuildRecord": true,
		"deleteTestResults": true
	}],
	"properties": {},
	"tags": [],
	"metrics": [{
		"name": "CurrentBuildsInQueue",
		"scope": "refs/heads/master",
		"intValue": 0
	}, {
		"name": "CurrentBuildsInProgress",
		"scope": "refs/heads/master",
		"intValue": 0
	}, {
		"name": "CurrentBuildsInQueue",
		"scope": "refs/heads/dev",
		"intValue": 0
	}, {
		"name": "CurrentBuildsInProgress",
		"scope": "refs/heads/dev",
		"intValue": 0
	}, {
		"name": "CurrentBuildsInQueue",
		"scope": "refs/heads/master",
		"intValue": 0
	}, {
		"name": "CurrentBuildsInProgress",
		"scope": "refs/heads/master",
		"intValue": 0
	}, {
		"name": "CurrentBuildsInQueue",
		"scope": "refs/heads/dev",
		"intValue": 0
	}, {
		"name": "CurrentBuildsInProgress",
		"scope": "refs/heads/dev",
		"intValue": 1
	}, {
		"name": "CanceledBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-05T00:00:00.000Z"
	}, {
		"name": "FailedBuilds",
		"scope": "refs/heads/dev",
		"intValue": 2,
		"date": "2018-07-05T00:00:00.000Z"
	}, {
		"name": "PartiallySuccessfulBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-05T00:00:00.000Z"
	}, {
		"name": "SuccessfulBuilds",
		"scope": "refs/heads/dev",
		"intValue": 4,
		"date": "2018-07-05T00:00:00.000Z"
	}, {
		"name": "TotalBuilds",
		"scope": "refs/heads/dev",
		"intValue": 6,
		"date": "2018-07-05T00:00:00.000Z"
	}, {
		"name": "CanceledBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-03T00:00:00.000Z"
	}, {
		"name": "FailedBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-03T00:00:00.000Z"
	}, {
		"name": "PartiallySuccessfulBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-03T00:00:00.000Z"
	}, {
		"name": "SuccessfulBuilds",
		"scope": "refs/heads/dev",
		"intValue": 2,
		"date": "2018-07-03T00:00:00.000Z"
	}, {
		"name": "TotalBuilds",
		"scope": "refs/heads/dev",
		"intValue": 2,
		"date": "2018-07-03T00:00:00.000Z"
	}, {
		"name": "CanceledBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-02T00:00:00.000Z"
	}, {
		"name": "FailedBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-02T00:00:00.000Z"
	}, {
		"name": "PartiallySuccessfulBuilds",
		"scope": "refs/heads/dev",
		"intValue": 0,
		"date": "2018-07-02T00:00:00.000Z"
	}, {
		"name": "SuccessfulBuilds",
		"scope": "refs/heads/dev",
		"intValue": 1,
		"date": "2018-07-02T00:00:00.000Z"
	}, {
		"name": "TotalBuilds",
		"scope": "refs/heads/dev",
		"intValue": 1,
		"date": "2018-07-02T00:00:00.000Z"
	}],
	"_links": {
		"self": {
			"href": "https://tfs.devopshub.cn/leansoft/580b5af0-a2f5-4585-8ed6-dddf6a84502d/_apis/build/Definitions/79?revision=43"
		},
		"web": {
			"href": "https://tfs.devopshub.cn/_permalink/_build/index?collectionId=40da8825-511b-4256-8dca-a9936011ad23&projectId=580b5af0-a2f5-4585-8ed6-dddf6a84502d&definitionId=79"
		},
		"editor": {
			"href": "https://tfs.devopshub.cn/_permalink/_build/definitionEditor?collectionId=40da8825-511b-4256-8dca-a9936011ad23&projectId=580b5af0-a2f5-4585-8ed6-dddf6a84502d&definitionId=79"
		}
	},
	"buildNumberFormat": "$(envFolder)-u$(labsUserId)-g$(groupId)-b$(BuildID)",
	"jobAuthorizationScope": 1,
	"jobTimeoutInMinutes": 60,
	"jobCancelTimeoutInMinutes": 5,
	"process": {
		"phases": [{
			"steps": [{
				"environment": {},
				"enabled": true,
				"continueOnError": false,
				"alwaysRun": false,
				"displayName": "从  中删除文件",
				"timeoutInMinutes": 0,
				"condition": "succeeded()",
				"refName": "DeleteFiles5",
				"task": {
					"id": "b7e8b412-0437-4065-9371-edc5881de25b",
					"versionSpec": "1.*",
					"definitionType": "task"
				},
				"inputs": {
					"SourceFolder": "",
					"Contents": "$(envFolder)/labs/result.json"
				}
			}, {
				"environment": {},
				"enabled": true,
				"continueOnError": false,
				"alwaysRun": false,
				"displayName": "Replace nomal paras with build variable",
				"timeoutInMinutes": 0,
				"condition": "succeeded()",
				"refName": "replacetokens2",
				"task": {
					"id": "a8515ec8-7254-4ffd-912c-86772e2b5962",
					"versionSpec": "2.*",
					"definitionType": "task"
				},
				"inputs": {
					"rootDirectory": "",
					"targetFiles": "$(envFolder)/labs/labs-azuredeploy.parameters.json",
					"encoding": "auto",
					"writeBOM": "true",
					"actionOnMissing": "warn",
					"keepToken": "false",
					"tokenPrefix": "#{",
					"tokenSuffix": "}#",
					"emptyValue": "(empty)",
					"escapeChar": "",
					"charsToEscape": ""
				}
			}, {
				"environment": {},
				"enabled": true,
				"continueOnError": false,
				"alwaysRun": false,
				"displayName": "Replace dynamic paras with powershell",
				"timeoutInMinutes": 0,
				"condition": "succeeded()",
				"refName": "PowerShell2",
				"task": {
					"id": "e213ff0f-5d5c-4791-802d-52ea3e7be1f1",
					"versionSpec": "1.*",
					"definitionType": "task"
				},
				"inputs": {
					"scriptType": "filePath",
					"scriptName": "Labs-Init-Parameters.ps1",
					"arguments": "-ArtifactStagingDirectory $(envFolder)  -buildId $(Build.BuildId) -imagesJson \"$(imagesJson)\"",
					"workingFolder": "",
					"inlineScript": "# You can write your powershell scripts inline here. \n# You can also pass predefined and custom variables to this scripts using arguments\n\n Write-Host \"Hello World\"",
					"failOnStandardError": "true"
				}
			}, {
				"environment": {},
				"enabled": true,
				"continueOnError": false,
				"alwaysRun": false,
				"displayName": "Genrate Enviroment",
				"timeoutInMinutes": 0,
				"condition": "succeeded()",
				"refName": "ClonedPowerShell26",
				"task": {
					"id": "e213ff0f-5d5c-4791-802d-52ea3e7be1f1",
					"versionSpec": "1.*",
					"definitionType": "task"
				},
				"inputs": {
					"scriptType": "filePath",
					"scriptName": "Labs-Deploy-AzureResourceGroup.ps1",
					"arguments": "-azureAccountName \"$(azureAccountName)\" -azurePasswordString \"$(azurePassword)\"  -subscriptionID \"$(azureSubscriptionId)\" -buildId $(Build.BuildId)  -ResourceGroupLocation '$(azureResourceLocation)' -ArtifactStagingDirectory $(envFolder)  -UploadArtifacts -StorageAccountName “$(StorageAccountName)” -ResourceGroupName $(envInstanceName)-$(envFolder)-u$(labsUserId) -EnvironmentName \"$(azureEnvironmentName)\" -groupId '$(groupId)' -azureUserName labs-test-u$(labsUserId) -createAzureUser $false ",
					"workingFolder": "",
					"inlineScript": "# You can write your powershell scripts inline here. \n# You can also pass predefined and custom variables to this scripts using arguments\n\n Write-Host \"Hello World\"",
					"failOnStandardError": "true"
				}
			}, {
				"environment": {},
				"enabled": true,
				"continueOnError": false,
				"alwaysRun": false,
				"displayName": "Copy result.json",
				"timeoutInMinutes": 0,
				"condition": "succeeded()",
				"refName": "CopyFiles4",
				"task": {
					"id": "5bfb729a-a7c8-4a78-a7c3-8d717bb7c13c",
					"versionSpec": "2.*",
					"definitionType": "task"
				},
				"inputs": {
					"SourceFolder": "",
					"Contents": "$(envFolder)/labs/result.json",
					"TargetFolder": "$(build.artifactstagingdirectory)",
					"CleanTargetFolder": "false",
					"OverWrite": "false",
					"flattenFolders": "false"
				}
			}, {
				"environment": {},
				"enabled": true,
				"continueOnError": true,
				"alwaysRun": false,
				"displayName": "发布项目: drop",
				"timeoutInMinutes": 0,
				"condition": "succeeded()",
				"refName": "PublishBuildArtifacts4",
				"task": {
					"id": "2ff763a7-ce83-4e1f-bc89-0ae63477cebe",
					"versionSpec": "1.*",
					"definitionType": "task"
				},
				"inputs": {
					"PathtoPublish": "$(build.artifactstagingdirectory)/$(envFolder)/labs/result.json",
					"ArtifactName": "drop",
					"ArtifactType": "Container",
					"TargetPath": "\\\\my\\share\\$(Build.DefinitionName)\\$(Build.BuildNumber)",
					"Parallel": "false",
					"ParallelCount": "8"
				}
			}],
			"name": "阶段 1",
			"refName": "Phase_1",
			"condition": "succeeded()",
			"target": {
				"executionOptions": {
					"type": 0
				},
				"allowScriptsAuthAccessOption": false,
				"type": 1
			},
			"jobAuthorizationScope": "projectCollection",
			"jobCancelTimeoutInMinutes": 1
		}],
		"type": 1
	},
	"repository": {
		"properties": {
			"cleanOptions": "2",
			"labelSources": "0",
			"labelSourcesFormat": "$(build.buildNumber)",
			"reportBuildStatus": "true",
			"gitLfsSupport": "false",
			"skipSyncSource": "false",
			"checkoutNestedSubmodules": "false",
			"fetchDepth": "0"
		},
		"id": "c7b967d3-afbc-4038-8346-475afde9f52d",
		"type": "TfsGit",
		"name": "labs-templates",
		"url": "https://tfs.devopshub.cn/leansoft/Labs/_git/labs-templates",
		"defaultBranch": "refs/heads/dev",
		"clean": "true",
		"checkoutSubmodules": false
	},
	"processParameters": {},
	"quality": 1,
	"authoredBy": {
		"displayName": "周文洋(Jacky Zhou)",
		"url": "https://tfs.devopshub.cn/leansoft/_apis/Identities/645e9864-ef7b-4d98-b2ee-21718b5735f2",
		"_links": {
			"avatar": {
				"href": "https://tfs.devopshub.cn/leansoft/_api/_common/identityImage?id=645e9864-ef7b-4d98-b2ee-21718b5735f2"
			}
		},
		"id": "645e9864-ef7b-4d98-b2ee-21718b5735f2",
		"uniqueName": "LEANSOFT\\jackyzhou",
		"imageUrl": "https://tfs.devopshub.cn/leansoft/_api/_common/identityImage?id=645e9864-ef7b-4d98-b2ee-21718b5735f2"
	},
	"drafts": [],
	"queue": {
		"_links": {
			"self": {
				"href": "https://tfs.devopshub.cn/leansoft/_apis/build/Queues/155"
			}
		},
		"id": 155,
		"name": "LSEN-MPN150-7-win-agt",
		"url": "https://tfs.devopshub.cn/leansoft/_apis/build/Queues/155",
		"pool": {
			"id": 18,
			"name": "LSEN-MPN150-7-win-agt"
		}
	},
	"id": 79,
	"name": "labs-templates-env-instance",
	"url": "https://tfs.devopshub.cn/leansoft/580b5af0-a2f5-4585-8ed6-dddf6a84502d/_apis/build/Definitions/79?revision=43",
	"uri": "vstfs:///Build/Definition/79",
	"path": "\\labs-test",
	"type": 2,
	"queueStatus": 0,
	"revision": 43,
	"createdDate": "2018-07-05T09:45:30.957Z",
	"project": {
		"id": "580b5af0-a2f5-4585-8ed6-dddf6a84502d",
		"name": "Labs",
		"url": "https://tfs.devopshub.cn/leansoft/_apis/projects/580b5af0-a2f5-4585-8ed6-dddf6a84502d",
		"state": "wellFormed",
		"revision": 377,
		"visibility": 0
	}
}